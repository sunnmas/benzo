1 Справочники
a.«АЗС» – реквизиты: Наименование, НомерАЗС-число. Табличная часть Емкости:
Номенклатура, Объем.
b.«Номенклатура» - реквизиты: Наименование, Внешний код – число.
c.«КонтрагентыОбщие» - реквизиты: Наименование, НаименованиеПолное, ИНН,
КПП, почта, телефон.
d.КонтрагентыАЗС – реквизиты: Наименование, АЗС, ГолонойКонтрагент – тип
КонтрагентыОбщие



e.Карты – реквизиты: номер, КонтрагентОбщие, ТипКарты – перечисление
Дисконтная или Топливная, Состояние – ВРаботе/Заблокирована/НеВыдана

    Файл CARD_2_.....
    ----------------------------------
    300;00000001777555544073;;;True;False;False;False;;;;сЕРОВ а.в. 4407 89376760484
    3000;00000001555777700633;23;;True;False;False;False;;;;0053 Г.№ Е152ТР
    300;00000001777555544080;;;True;False;False;False;;;;пАРШЕНКОВ в.и. 4408 89879955315

    1   DistCode        I       Код эмитента карт. (Обязательно !!! и не должно быть равно 0)
    2   Code            A   20  Номер катры (Обязательно !!! и не должно быть равно ‘’)
    3   ClientCode      I       Код клиента. (не должно быть равно 0)
    4   ToDate          D       Дата окончания срока действия карты
    5   Enabled         L       Признак «карта разрешена/запрещена»
    6   UseDate         L       Признак – проверять ли срок действия карты по полю ToDate (True – проверять, False – не проверять)
    7   CheckBalance    L       Служебное
    8   Debit           L       Признак «+/-»  (True – литраж и сумма вычитаются  из  общего баланса клиента,  False – прибавляются к балансу)
    9   AmntDayLimit    $       Суточный лимит на общую денежную сумму отпущенного топлива. (Если поле пустое или 0 – лимита нет)
    10  AmntMonthLimit  $       Месячный лимит на общую денежную сумму отпущенного топлива. (Если поле пустое или 0 – лимита нет)
    11  AmntTotalLimit  $       Лимит на общую денежную сумму (денежный баланс). (Если поле пустое или 0 – лимита нет)
    12  Note            A   50  Примечание


    !!Код клиента заполнен очень редко



f.Основания – наименование, внешнийкод, ВидОплаты – наличгые или
безналичные.

2 Документы
a.ОтчетОПродажах – реквизиты: Дата, АЗС, Оператор, СуммаНал, СуммаБезНал.
ТабЧасть: ЦеныНаАЗС считываются из РС. Еще ТабличнаяЧасть: время,
контрагентазс, контрагентОбщий, номерКарты, Номенклатура, количество(литров),
сумма, основание, видоплаты.


b.УстановкаЦен – Дата,ДатаПрименения, АЗС. ТабЧасть: Номенклатура, Цена.
Необходимо формировать документом установка цен и файл PRICE
№   Название поля   Тип Размер  Описание
1   Num             I           Код топлива
2   Marka           A   10      Название топлива
3   Price           $           Цена топлива
4   NextPrice       $           Отложенная цена на топливо
5   PriceChDate     D           Дата установки отложенной цены на топливо





c.ПополнениеСписание – Дата, ТабЧасть: КонтрагентОбщий, КонтрагентАЗС, Сумма,
БлокировкаРазблокировка - булево.

3 РегистрыСведений
a. ЦеныНаАЗС – АЗС, номенклатура, цена. Периодический.
4 РегистрыНакопления
a.ВзаиморасчетыСКонтрагентами – КонтрагентОбщий, Приход/Расход, Сумма
b.Продажи – АЗС, Основание, КонтрагентОбщий, Сумма.

1
«КонтрагентыОбщие» - при записи нового контрагента создаются такие же контрагенты
для всех АЗС в справочнике КонтрагентыАЗС.
2
Обработка «Отправка отчетов». Обработка перебирает всех контрагентов и если у них
занесена в базу почта формирует 2 отчета: Отчет по обслуживаниям и Состояние баланса и
отправляет им на почту.
3
Обработка «Загрузка и выгрузка данных». Две кнопки: Загрузка – загружает данные со
всех АЗС. Выгрузка: выгружает все данные на АЗС. Загрузка и выгрузка делается: по
требованию и автоматически каждый час.




Вопросы:
- Где описание формата файла для сообщения баланса/запрета/разрешения для наливной программы?
- Может ли меняться код контрагента в наливной программе?



SHIFT - список всех смен с указанием номера смены и времени начала и окончания смены





* Справочник АЗС формируем вручную

* Справочник КонтрагентыОбщие формируем вручную

* Справочник КонтрагентыАЗС грузим из файла CLNT
    - Предотвращена повторная загрузка контрагентаАзс из файла, если в базе уже есть запись с таким внешним кодом и данной АЗС 
    - Если на соседней АЗС есть контрагент с данным внешним кодом, то появится элемент с дубляжом внешнего кода, но уникальный по номеру АЗС
    - Если на соседней АЗС есть контрагент с данным наименованием, то появится элемент с дубляжом наименования, но с уникальной парой: внешнийКод и АЗС
    !- Если в наливной программе меняется наименование контрагента, то в базе изменение фиксируется
    - Если в наливной программе изменился код контрагента - получим дубль контрагента в базе
    - Т.к. справочник заполняется автоматически - запрещаем править все реквизиты кроме головного контрагента, для предотвращения нарушения целостности
    - Запрет создания новых КонтрагентовАЗС вручную
    - Запрет удаления КонтрагентовАЗС вручную


* Справочник Карты грузим из файла CARD
    - 300 - Дисконтная
    - 3000 - Топливная
    - Enabled = True - ВРаботе
    - Enabled = False - Заблокирована
    - НеВыдана только для топливной карты, если не назначен код клиента
    - Запрет редактирования всех полей кроме КонтрагентОбщий и Состояние
    - При записи карты с выбранным КонтрагентОбщий автоматически проставляется реквизит ГоловнойКонтрагент для всех
        КонтрагентовАЗС, привязанных к карте
    - При создании дисконтной карты реквизиту КонтрагентОбщий назначается предопределенный элемент справочника РозничныйПокупатель
    - При попытке сменить у дисконтной карты КонтрагентОбщий с РозничногоПокупателя на какой либо другой приводит к отказу записи с выводом сообщения об ошибке
    - Запрет создания новых карт вручную
    - Запрет удаления крат вручную





SALE

OPERATORAZS;                OPERATORAZS;                    1   Host        A   16  Название компьютера (имеет смысл для многопользовательской версии)
27.12.2020 10:38:33;        27.12.2020 10:19:45;            2   DateTime    @       Дата и время продажи
2;                          7;                              3   NumTRK      S       № ТРК
52;                         0; !!!!!!!!!!!!!!!!!!!!!        4   ClientCode  I       Код клиента
00000001555777702408;       00000001777555519880;           5   CardCode    A   20  Номер карты
3000;                       300;                            6   DistCode    I       Код эмитента карт
22;                         92;                             7   Product     S       Код вида топлива
200;                        11,9;                           8   LitPresel   N       Заказ (в литрах)
200;                        500;                            9   CurPresel   $       Заказ (в деньгах)
1;                          40,74;                          10  Price       $       Цена, по которой отпущено топливо
38,61;                      11,91;                          11  LitFact     N       Фактически отпущенное количество литров топлива
38,61;                      485,21;                         12  CurFact     $       Фактическая сумма (на которую отпущено топливо)
1;                          0;                              13  PaymentKind I       Тип платежа: 0 – Нал. / 1 – Безнал.
8;                          7;                              14  Osnovanye   I       Основание, на котором происходила продажа (Скидка, тех. Пролив и т.д.)
5;                          4;                              15  NumTank     S       № емкости, из которой происходил налив
1;                          1;                              16  NumNozz     S       № пистолета, с которого происходил налив
;                           ;                               17  CancelCh    S       Признак того, что печать чека была отменена оператором или для операций с картами - был возврат без предъявления карты
                                                                            Коды:
                                                                             1 – чек по факту
                                                                             2 – чек по заказу
                                                                             3 – чек возврата
                                                                             4 – чек аннулирования
                                                                            13 – возврат без предъявления карты

;                ;                               18  Note        A   50  Примечание
;                ;                               19  Density     N       Текущая плотность в резервуаре (с вер 2.20)
;                ;                               20  Temperature N       Текущая температура в резервуаре (с вер 2.20)
24,1;                42;                             21  BasePrice   $       Базовая цена топлива
False                True                            22  PP          L       Признак (предоплата — False / постоплата - True)





3.18 Структура выходного файла  с информацией о картах:  - CARD_X


Динамическое Состояние выполнения обработки
Основания


Выгрузка карт
Не выгружать помеченные на удаление

Отчет о продажах
        Смена закрыта


Одинаковые ли цены на заправках?

Обработка нескольких файлов данных в папке

Представление номенклатуры в виде строки для выгрузки
отчет состояние баланса
отсылка всем контрагентам
выгрузка справочников

отчет Взаиморасчеты
Параметры отчета Взаиморасчеты
Отправка отчета Взаиморасчеты
отправка двух очетов по почте